# =============================================================================
# Igra Configuration (TOML)
# =============================================================================
# Converted from: igra-config.ini
# See CONFIG_REFACTORING.md for migration details
#
# Full reference (defaults, requiredness, cross-checks): `docs/configuration-reference.md`

[service]
# Explicitly confirm the intended network mode (recommended in all environments).
# - Mainnet requires this confirmation (`service.network = "mainnet"`).
network = "devnet"

# Optional fallback for profile selection (recommended to use CLI `--profile signer-XX` instead).
# active_profile = "signer-01"

# Kaspa node RPC endpoint.
node_rpc_url = "grpc://127.0.0.1:16110"

# Base data dir. Profiles typically override this per signer (one data dir per signer).
data_dir = "./.igra"

# Secrets backend:
# - true  => encrypted secrets file (`secrets.bin`) under each profileâ€™s `data_dir` (recommended)
# - false => environment-based secrets (devnet/CI only; requires `--features devnet-env-secrets`)
use_encrypted_secrets = true

# Optional explicit secrets file path. When omitted and `use_encrypted_secrets=true`,
# defaults to `${service.data_dir}/secrets.bin`.
# secrets_file = "./.igra/secrets.bin"

[service.pskt]
# Funding/source address(es) to scan UTXOs from.
# Recommended: omit/empty and derive from `redeem_script_hex` + `service.network`.
source_addresses = []

# Canonical source of truth for multisig spending policy (m-of-n + pubkeys).
redeem_script_hex = "5220a4ebef8e3553bd9bf9212c8c66c356d4beee198580cf9e85dc20a9305e5daba920b93ff1c2c3c89b5284e7e62c090032a3dac67a62b8b0372f9417ee5ee58b6d7b20ca1582d546037ff74ebc280c84a40d7118c0959b7885b94eba69a578b273deec53ae"

# SigOp upper bound for tx mass/standardness checks. Recommended: `threshold_n`.
sig_op_count = 2
fee_payment_mode = "recipient_pays"
fee_sompi = 0

# Optional change address (defaults to the derived multisig address if omitted).
# change_address = "kaspadev:..."

[service.hd]
# How this signer derives its signing key material from SecretStore:
# - hd_mnemonic: reads `igra.signer.mnemonic_<profile>` (for dev/test only; mainnet forbids)
# - raw_private_key: reads `igra.signer.private_key_<profile>` (32 bytes)
key_type = "hd_mnemonic"

# Required signatures (m) when deriving a redeem script from HD pubkeys.
# Redundant if `service.pskt.redeem_script_hex` is provided and `[group]` is configured.
required_sigs = 2

[runtime]
test_mode = true
test_recipient = "kaspadev:qzunluwzc0yfk55yulnzczgqx23a43n6v2utqde0jst7uhh93dkhkp80l2wca"
test_amount_sompi = 123456
session_timeout_seconds = 60

[signing]
backend = "threshold"

[rpc]
addr = "127.0.0.1:8088"
enabled = true

[policy]
# NOTE: policy is included in `group_id` derivation (changing it changes the group id).
allowed_destinations = ["kaspadev:qr9ptqk4gcphla6whs5qep9yp4c33sy4ndugtw2whf56279jw00wcqlxl3lq3"]
min_amount_sompi = 1000000
max_amount_sompi = 100000000000
max_daily_volume_sompi = 500000000000
require_reason = false

[group]
# Canonical signer set and threshold. Startup validation cross-checks this against the redeem script.
threshold_m = 2
threshold_n = 3
member_pubkeys = [
    "a4ebef8e3553bd9bf9212c8c66c356d4beee198580cf9e85dc20a9305e5daba9",
    "b93ff1c2c3c89b5284e7e62c090032a3dac67a62b8b0372f9417ee5ee58b6d7b",
    "ca1582d546037ff74ebc280c84a40d7118c0959b7885b94eba69a578b273deec"
]
fee_rate_sompi_per_gram = 0
finality_blue_score_threshold = 0
dust_threshold_sompi = 0
min_recipient_amount_sompi = 0
session_timeout_seconds = 60

[hyperlane]
validators = [
    "039a8d46063004a62914db7eb40e445e2500331c7f1263d4596e3e3cc6bc7bc82c",
    "02f5c3507cd1dc83a1e890a830bcfd452ea12ee93537e76bc30a3130ac7138203c"
]
threshold = 2
poll_secs = 10

[iroh]
group_id = "79760c316bd2c7890ba04dfb7a8e112555dc34da56bb3ae2dd93dec953e3b2ba"
# Verifier set for peer signatures: `"peer_id:ed25519_pubkey_hex"`.
verifier_keys = ["coordinator-1:02a4ebef8e3553bd9bf9212c8c66c356d4beee198580cf9e85dc20a9305e5daba9"]

# =============================================================================
# Signer Profiles
# =============================================================================
# Use --profile <name> to load a specific profile
# Example: igra-service --profile signer-01

[profiles.signer-01]

[profiles.signer-01.service]
data_dir = "./.igra/signer-01"

[profiles.signer-01.rpc]
addr = "127.0.0.1:8088"

[profiles.signer-01.iroh]
peer_id = "signer-01"
signer_seed_hex = "000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f"
group_id = "79760c316bd2c7890ba04dfb7a8e112555dc34da56bb3ae2dd93dec953e3b2ba"
network_id = 0
verifier_keys = [
    "signer-01:03a107bff3ce10be1d70dd18e74bc09967e4d6309ba50d5f1ddc8664125531b8",
    "signer-02:29acbae141bccaf0b22e1a94d34d0bc7361e526d0bfe12c89794bc9322966dd7",
    "signer-03:2543b92ff1095511476adc8369db6ddc933665a11978dda1404ee1066ca9559d"
]

[profiles.signer-02]

[profiles.signer-02.service]
data_dir = "./.igra/signer-02"

[profiles.signer-02.rpc]
addr = "127.0.0.1:8089"

[profiles.signer-02.iroh]
peer_id = "signer-02"
signer_seed_hex = "202122232425262728292a2b2c2d2e2f303132333435363738393a3b3c3d3e3f"
group_id = "79760c316bd2c7890ba04dfb7a8e112555dc34da56bb3ae2dd93dec953e3b2ba"
network_id = 0
verifier_keys = [
    "signer-01:03a107bff3ce10be1d70dd18e74bc09967e4d6309ba50d5f1ddc8664125531b8",
    "signer-02:29acbae141bccaf0b22e1a94d34d0bc7361e526d0bfe12c89794bc9322966dd7",
    "signer-03:2543b92ff1095511476adc8369db6ddc933665a11978dda1404ee1066ca9559d"
]

[profiles.signer-03]

[profiles.signer-03.service]
data_dir = "./.igra/signer-03"

[profiles.signer-03.rpc]
addr = "127.0.0.1:8090"

[profiles.signer-03.iroh]
peer_id = "signer-03"
signer_seed_hex = "404142434445464748494a4b4c4d4e4f505152535455565758595a5b5c5d5e5f"
group_id = "79760c316bd2c7890ba04dfb7a8e112555dc34da56bb3ae2dd93dec953e3b2ba"
network_id = 0
verifier_keys = [
    "signer-01:03a107bff3ce10be1d70dd18e74bc09967e4d6309ba50d5f1ddc8664125531b8",
    "signer-02:29acbae141bccaf0b22e1a94d34d0bc7361e526d0bfe12c89794bc9322966dd7",
    "signer-03:2543b92ff1095511476adc8369db6ddc933665a11978dda1404ee1066ca9559d"
]
